{
  "version": 3,
  "sources": ["../../src/js/media-captions-button.js"],
  "sourcesContent": ["import MediaChromeButton from './media-chrome-button.js';\nimport { defineCustomElement } from './utils/defineCustomElement.js';\nimport {\n  Window as window,\n  Document as document,\n} from './utils/server-safe-globals.js';\nimport { MediaUIEvents, MediaUIAttributes } from './constants.js';\nimport { nouns } from './labels/labels.js';\nimport { splitTextTracksStr } from './utils/captions.js';\n\nconst ccIconOn = `\n<svg\n   aria-hidden=\"true\"\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\n   xmlns=\"http://www.w3.org/2000/svg\"\n   version=\"1.0\"\n   viewbox=\"0 0 153 125.71389\"\n   width=\"auto\"\n   height=\"24\">\n  <g\n     transform=\"scale(6.3080558,6.3080558)\"\n     id=\"g12\">\n    <path\n       class=\"icon\" \n       d=\"M 21.9806,9.0135 C 21.9505,5.8358 21.8299,4.4502 21.077,3.4712 C 20.9415,3.2605 20.6854,3.14 20.4746,2.9895 C 19.7366,2.4472 16.2577,2.2515 12.2215,2.2515 C 8.1853,2.2515 4.54077,2.4472 3.81787,2.9895 C 3.59192,3.14 3.33581,3.2605 3.1853,3.4712 C 2.44726,4.4502 2.34192,5.8358 2.29675,9.0135 C 2.34192,12.1914 2.44726,13.5769 3.1853,14.5558 C 3.33581,14.7817 3.59192,14.8871 3.81787,15.0377 C 4.54077,15.595 8.1853,15.7757 12.2215,15.8058 C 16.2577,15.7757 19.7366,15.595 20.4746,15.0377 C 20.6854,14.8871 20.9415,14.7817 21.077,14.5558 C 21.8299,13.5769 21.9505,12.1914 21.9806,9.0135 z \"\n       style=\"fill-rule:evenodd;stroke:none\"\n       id=\"path16\" />\n    <path\n       class=\"icon\" \n       d=\"M 11.6896,8.1906 C 11.4853,5.704 10.1628,4.239 7.79723,4.239 C 5.63596,4.239 3.93706,6.1879 3.93706,9.31964 C 3.93706,12.4648 5.48544,14.4271 8.04452,14.4271 C 10.0875,14.4271 11.5176,12.9218 11.7434,10.4217 L 9.30256,10.4217 C 9.20579,11.3492 8.81871,12.0616 8.00151,12.0616 C 6.71121,12.0616 6.47467,10.7847 6.47467,9.42716 C 6.47467,7.5588 7.0123,6.6046 7.90474,6.6046 C 8.70045,6.6046 9.20579,7.1825 9.28106,8.1906 L 11.6896,8.1906 z \"\n       style=\"fill:#000000;fill-rule:evenodd;stroke:none\"\n       id=\"path20\" />\n    <path\n      class=\"icon\" \n      d=\"M 20.1199,8.1906 C 19.9156,5.704 18.5931,4.239 16.2275,4.239 C 14.0662,4.239 12.3674,6.1879 12.3674,9.31964 C 12.3674,12.4648 13.9157,14.4271 16.4748,14.4271 C 18.5178,14.4271 19.9479,12.9218 20.1736,10.4217 L 17.7328,10.4217 C 17.6361,11.3492 17.249,12.0616 16.4318,12.0616 C 15.1415,12.0616 14.9049,10.7847 14.9049,9.42716 C 14.9049,7.5588 15.4426,6.6046 16.335,6.6046 C 17.1307,6.6046 17.6361,7.1825 17.7113,8.1906 L 20.1199,8.1906 z \"\n      style=\"fill:#000000;fill-rule:evenodd;stroke:none\"\n      id=\"path22\" />\n    <path class=\"icon\" d=\"M 2,20 L 22,20\" stroke-width=\"4\" stroke=\"var(--media-icon-color, #eee)\" id=\"path24\"/>\n  </g>\n</svg>\n`;\n\nconst ccIconOff = `\n<svg\n   aria-hidden=\"true\"\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\n   xmlns=\"http://www.w3.org/2000/svg\"\n   version=\"1.0\"\n   viewbox=\"0 0 153 125.71389\"\n   width=\"auto\"\n   height=\"24\">\n  <g\n     transform=\"scale(6.3080558,6.3080558)\"\n     id=\"g12\">\n    <path\n       class=\"icon\" \n       d=\"M 21.9806,9.0135 C 21.9505,5.8358 21.8299,4.4502 21.077,3.4712 C 20.9415,3.2605 20.6854,3.14 20.4746,2.9895 C 19.7366,2.4472 16.2577,2.2515 12.2215,2.2515 C 8.1853,2.2515 4.54077,2.4472 3.81787,2.9895 C 3.59192,3.14 3.33581,3.2605 3.1853,3.4712 C 2.44726,4.4502 2.34192,5.8358 2.29675,9.0135 C 2.34192,12.1914 2.44726,13.5769 3.1853,14.5558 C 3.33581,14.7817 3.59192,14.8871 3.81787,15.0377 C 4.54077,15.595 8.1853,15.7757 12.2215,15.8058 C 16.2577,15.7757 19.7366,15.595 20.4746,15.0377 C 20.6854,14.8871 20.9415,14.7817 21.077,14.5558 C 21.8299,13.5769 21.9505,12.1914 21.9806,9.0135 z \"\n       style=\"fill-rule:evenodd;stroke:none\"\n       id=\"path16\" />\n    <path\n       class=\"icon\" \n       d=\"M 11.6896,8.1906 C 11.4853,5.704 10.1628,4.239 7.79723,4.239 C 5.63596,4.239 3.93706,6.1879 3.93706,9.31964 C 3.93706,12.4648 5.48544,14.4271 8.04452,14.4271 C 10.0875,14.4271 11.5176,12.9218 11.7434,10.4217 L 9.30256,10.4217 C 9.20579,11.3492 8.81871,12.0616 8.00151,12.0616 C 6.71121,12.0616 6.47467,10.7847 6.47467,9.42716 C 6.47467,7.5588 7.0123,6.6046 7.90474,6.6046 C 8.70045,6.6046 9.20579,7.1825 9.28106,8.1906 L 11.6896,8.1906 z \"\n       style=\"fill:#000000;fill-rule:evenodd;stroke:none\"\n       id=\"path20\" />\n    <path\n      class=\"icon\" \n      d=\"M 20.1199,8.1906 C 19.9156,5.704 18.5931,4.239 16.2275,4.239 C 14.0662,4.239 12.3674,6.1879 12.3674,9.31964 C 12.3674,12.4648 13.9157,14.4271 16.4748,14.4271 C 18.5178,14.4271 19.9479,12.9218 20.1736,10.4217 L 17.7328,10.4217 C 17.6361,11.3492 17.249,12.0616 16.4318,12.0616 C 15.1415,12.0616 14.9049,10.7847 14.9049,9.42716 C 14.9049,7.5588 15.4426,6.6046 16.335,6.6046 C 17.1307,6.6046 17.6361,7.1825 17.7113,8.1906 L 20.1199,8.1906 z \"\n      style=\"fill:#000000;fill-rule:evenodd;stroke:none\"\n      id=\"path22\" />\n  </g>\n</svg>\n`;\n\nconst slotTemplate = document.createElement('template');\nslotTemplate.innerHTML = `\n  <style>\n  :host([aria-checked=\"true\"]) slot:not([name=on]) > *, \n  :host([aria-checked=\"true\"]) ::slotted(:not([slot=on])) {\n    display: none;\n  }\n\n  /* Double negative, but safer if display doesn't equal 'block' */\n  :host(:not([aria-checked=\"true\"])) slot:not([name=off]) > *, \n  :host(:not([aria-checked=\"true\"])) ::slotted(:not([slot=off])) {\n    display: none;\n  }\n  </style>\n\n  <slot name=\"on\">${ccIconOn}</slot>\n  <slot name=\"off\">${ccIconOff}</slot>\n`;\n\nconst updateAriaChecked = (el) => {\n  el.setAttribute('aria-checked', isCCOn(el));\n};\n\nconst isCCOn = (el) => {\n  const showingCaptions = !!el.getAttribute(\n    MediaUIAttributes.MEDIA_CAPTIONS_SHOWING\n  );\n  const showingSubtitlesAsCaptions =\n    !el.hasAttribute('no-subtitles-fallback') &&\n    !!el.getAttribute(MediaUIAttributes.MEDIA_SUBTITLES_SHOWING);\n  return showingCaptions || showingSubtitlesAsCaptions;\n};\n\nclass MediaCaptionsButton extends MediaChromeButton {\n  static get observedAttributes() {\n    return [\n      ...super.observedAttributes,\n      'no-subtitles-fallback',\n      'default-showing',\n      MediaUIAttributes.MEDIA_CAPTIONS_LIST,\n      MediaUIAttributes.MEDIA_CAPTIONS_SHOWING,\n      MediaUIAttributes.MEDIA_SUBTITLES_LIST,\n      MediaUIAttributes.MEDIA_SUBTITLES_SHOWING,\n    ];\n  }\n\n  constructor(options = {}) {\n    super({ slotTemplate, ...options });\n    // Internal variable to keep track of when we have some or no captions (or subtitles, if using subtitles fallback)\n    // Used for `default-showing` behavior.\n    this._captionsReady = false;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.setAttribute('role', 'switch');\n    this.setAttribute('aria-label', nouns.CLOSED_CAPTIONS());\n    updateAriaChecked(this);\n  }\n\n  attributeChangedCallback(attrName, oldValue, newValue) {\n    if (\n      [\n        MediaUIAttributes.MEDIA_CAPTIONS_SHOWING,\n        MediaUIAttributes.MEDIA_SUBTITLES_SHOWING,\n      ].includes(attrName)\n    ) {\n      updateAriaChecked(this);\n    }\n    if (\n      this.hasAttribute('default-showing') && // we want to show captions by default\n      this.getAttribute('aria-checked') !== 'true' // and we aren't currently showing them\n    ) {\n      // Make sure we're only checking against the relevant attributes based on whether or not we are using subtitles fallback\n      const subtitlesIncluded = !this.hasAttribute('no-subtitles-fallback');\n      const relevantAttributes = subtitlesIncluded\n        ? [\n            MediaUIAttributes.MEDIA_CAPTIONS_LIST,\n            MediaUIAttributes.MEDIA_SUBTITLES_LIST,\n          ]\n        : [MediaUIAttributes.MEDIA_CAPTIONS_LIST];\n      // If one of the relevant attributes changed...\n      if (relevantAttributes.includes(attrName)) {\n        // check if we went\n        // a) from captions (/subs) not ready to captions (/subs) ready\n        // b) from captions (/subs) ready to captions (/subs) not ready.\n        // by using a simple truthy (empty or non-empty) string check on the relevant values\n        // NOTE: We're using `getAttribute` here instead of `newValue` because we may care about\n        // multiple attributes.\n        const nextCaptionsReady =\n          !!this.getAttribute(MediaUIAttributes.MEDIA_CAPTIONS_LIST) ||\n          !!(\n            subtitlesIncluded &&\n            this.getAttribute(MediaUIAttributes.MEDIA_SUBTITLES_LIST)\n          );\n        // If the value changed, (re)set the internal prop\n        if (this._captionsReady !== nextCaptionsReady) {\n          this._captionsReady = nextCaptionsReady;\n          // If captions are currently ready, that means we went from unready to ready, so\n          // use the click handler to dispatch a request to turn captions on\n          if (this._captionsReady) {\n            this.handleClick();\n          }\n        }\n      }\n    }\n    super.attributeChangedCallback(attrName, oldValue, newValue);\n  }\n\n  handleClick(_e) {\n    const ccIsOn = isCCOn(this);\n    if (ccIsOn) {\n      // Closed Captions is on. Clicking should disable any currently showing captions (and subtitles, if relevant)\n      // For why we are requesting tracks to `mode=\"disabled\"` and not `mode=\"hidden\"`, see: https://github.com/muxinc/media-chrome/issues/60\n      const captionsShowingStr = this.getAttribute(\n        MediaUIAttributes.MEDIA_CAPTIONS_SHOWING\n      );\n      // If we have currently showing captions track(s), request for them to be disabled.\n      if (captionsShowingStr) {\n        const evt = new window.CustomEvent(\n          MediaUIEvents.MEDIA_DISABLE_CAPTIONS_REQUEST,\n          { composed: true, bubbles: true, detail: captionsShowingStr }\n        );\n        this.dispatchEvent(evt);\n      }\n      const subtitlesShowingStr = this.getAttribute(\n        MediaUIAttributes.MEDIA_SUBTITLES_SHOWING\n      );\n      // If we have currently showing subtitles track(s) and we're using subtitle fallback (true/\"on\" by default), request for them to be disabled.\n      if (subtitlesShowingStr && !this.hasAttribute('no-subtitles-fallback')) {\n        const evt = new window.CustomEvent(\n          MediaUIEvents.MEDIA_DISABLE_SUBTITLES_REQUEST,\n          { composed: true, bubbles: true, detail: subtitlesShowingStr }\n        );\n        this.dispatchEvent(evt);\n      }\n    } else {\n      // Closed Captions is off. Clicking should show the first relevant captions track or subtitles track if we're using subtitle fallback (true/\"on\" by default)\n      const [ccTrackStr] =\n        splitTextTracksStr(\n          this.getAttribute(MediaUIAttributes.MEDIA_CAPTIONS_LIST) ?? ''\n        ) ?? [];\n      if (ccTrackStr) {\n        // If we have at least one captions track, request for the first one to be showing.\n        const evt = new window.CustomEvent(\n          MediaUIEvents.MEDIA_SHOW_CAPTIONS_REQUEST,\n          { composed: true, bubbles: true, detail: ccTrackStr }\n        );\n        this.dispatchEvent(evt);\n      } else if (!this.hasAttribute('no-subtitles-fallback')) {\n        // If we don't have a captions track and we're using subtitles fallback (true/\"on\" by default), check if we have any subtitles available.\n        const [subTrackStr] =\n          splitTextTracksStr(\n            this.getAttribute(MediaUIAttributes.MEDIA_SUBTITLES_LIST) ?? ''\n          ) ?? [];\n        if (subTrackStr) {\n          // If we have at least one subtitles track (and didn't have any captions tracks), request for the first one to be showing as a fallback for captions.\n          const evt = new window.CustomEvent(\n            MediaUIEvents.MEDIA_SHOW_SUBTITLES_REQUEST,\n            { composed: true, bubbles: true, detail: subTrackStr }\n          );\n          this.dispatchEvent(evt);\n        }\n      } else {\n        // If we end up here, it means we have an enabled CC-button that a user has clicked on but there are no captions and no subtitles (or we've disabled subtitles fallback).\n        console.error(\n          'Attempting to enable closed captions but none are available! Please verify your media content if this is unexpected.'\n        );\n      }\n    }\n  }\n}\n\ndefineCustomElement('media-captions-button', MediaCaptionsButton);\n\nexport default MediaCaptionsButton;\n"],
  "mappings": "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",
  "names": []
}
